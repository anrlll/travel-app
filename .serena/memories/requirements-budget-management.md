# TravelApp 要件定義 - 予算管理

**ステータス**: ✅ 確定
**最終更新**: 2025-10-09

---

## 概要

旅行の予算を管理し、実費記録、予算比較、メンバー別割り勘計算を行う機能。旅程のアクティビティと自動連携。

---

## 主要機能

### 費目管理
- 標準費目: 交通費、宿泊費、食費、観光費、アクティビティ費、ショッピング費、その他
- カスタマイズ可能（追加・削除・名前変更）
- アクティビティタイプから自動判定

### 通貨対応
- 複数通貨入力対応
- 為替レート自動取得（Exchangerate-API）
- 表示通貨の切り替え可能
- 入力時のレート記録（後から変わらない）

### 予算設定
- 総予算、費目別、日別、メンバー別（すべて設定可能）
- メンバー別予算はオプション

### 実費記録
- 旅程アクティビティから自動反映（リアルタイム同期）
- 手動入力も可能
- 必須項目: 金額、通貨、費目、日付
- オプション: メモ、領収書画像
- 定期支出の日割り計算（宿泊費等）

### 領収書画像
- データベース保存（Base64エンコード）
- 将来的にクラウドストレージに移行
- 初期は容量無制限
- OCR不要

### 予算と実費の比較
- 数値のみで表示（グラフ不要）
- 予算額、実費額、残額、使用率を表示
- 超過時は赤字表示（警告は不要）

### 旅程との連携
- アクティビティごとに予算項目自動作成
- 双方向編集可能
- 料金変更時に自動更新（デバウンス処理）

### メンバー別管理
- 誰が払ったか、誰が負担するかを記録
- 均等割り/不均等割り対応

### 割り勘計算
- 立て替え精算の自動計算
- 支払い回数最小化アルゴリズム
- 複数通貨は基準通貨に換算してから計算
- 精算ステータス管理（未精算/精算済み）

### テンプレート機能
- 費目・通貨・メンバー情報を含む
- 過去の旅行からコピー可能
- 初期は個人用のみ

### 履歴管理
- すべての変更を記録
- タイムライン形式で表示
- 誰が・いつ・何を変更したか

---

## 不要な機能

- グラフ・チャート表示
- PDF/CSV出力
- 支払い方法の記録
- 予算アラート・通知
- メンバー別サマリー表示

---

## 外部API

- **Exchangerate-API**: 為替レート取得（無料: 1,500回/月）
- キャッシング機能で呼び出し削減

---

## データベース

### テーブル
- budgets（予算設定）
- budget_categories（費目別予算）
- daily_budgets（日別予算）
- member_budgets（メンバー別予算）
- expenses（実費記録）
- expense_splits（支出の負担分割）
- settlements（精算情報）
- exchange_rates（為替レート履歴）
- budget_templates（予算テンプレート）
- budget_history（予算履歴）

詳細は requirements ドキュメント参照
