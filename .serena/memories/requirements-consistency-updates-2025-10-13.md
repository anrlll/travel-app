# TravelApp 要件定義ドキュメント - 整合性修正作業記録

**作業日**: 2025-10-13
**目的**: 全9つの要件定義ドキュメントの整合性を確保し、命名規則を統一

---

## 修正概要

前セッションで実施した「旅程(itinerary)」→「旅行プラン(trip_plan)」への命名変更に伴い、全ドキュメントの整合性を確保するための修正を実施しました。

---

## 実施した修正内容

### 1. 命名規則の統一

#### 00-overview.md
- **行24**: "旅程検索" → "旅行プラン検索"
- **行28**: 検索説明文で「作成済み旅程」→「作成済み旅行プラン」

#### 05-i18n.md (多言語対応)
- **行178**: `itinerary.json` → `trip_plan.json` (ファイル名変更)
- **行201**: 日本語ナビゲーションキー `"itinerary": "旅程"` → `"trip_plan": "旅行プラン"`
- **行228**: 英語ナビゲーションキー `"itinerary": "Itinerary"` → `"trip_plan": "Trip Plan"`

#### 03-budget-management.md (予算管理)
全ての「旅程」参照を「旅行プラン」に統一:
- **行11**: 概要文「旅程のアクティビティ」→「旅行プランのアクティビティ」
- **行39**: 「旅程のアクティビティから自動的に費目を判定」→「旅行プランのアクティビティから...」
- **行102**: セクションタイトル「自動記録（旅程との連携）」→「自動記録（旅行プランとの連携）」
- **行104**: 「旅程のアクティビティから自動反映」→「旅行プランのアクティビティから...」
- **行205**: セクションタイトル「旅程との連携」→「旅行プランとの連携」
- **行664**: テスト要件「旅程のアクティビティと自動連携する」→「旅行プランのアクティビティと...」

データベーステーブル定義のコメント統一:
- **行376**: `budgets`テーブル - `trip_id`カラム説明「旅程ID」→「旅行プランID」
- **行431**: `expenses`テーブル - `trip_id`カラム説明「旅程ID」→「旅行プランID」
- **行468**: `settlements`テーブル - `trip_id`カラム説明「旅程ID」→「旅行プランID」
- **行504**: `budget_history`テーブル - `trip_id`カラム説明「旅程ID」→「旅行プランID」

#### 04-memory-sharing.md (思い出の記録と共有)
全ての「旅程」参照を「旅行プラン」に統一:
- **行68-69**: 「旅程『新潟旅行A』を作成」→「旅行プラン『新潟旅行A』を作成」
- **行111**: セクションタイトル「旅程との紐付け」→「旅行プランとの紐付け」
- **行116**: 「旅程画面から追加」→「旅行プラン画面から追加」
- **行123**: 「旅程とアクティビティを選択」→「旅行プランとアクティビティを選択」
- **行127**: セクションタイトル「旅程画面での表示」→「旅行プラン画面での表示」
- **行129**: 「旅程画面に表示しない」→「旅行プラン画面に表示しない」
- **行131**: 「旅程画面をシンプルに保つため」→「旅行プラン画面をシンプルに保つため」
- **行183**: 「旅程全体に対して総合評価」→「旅行プラン全体に対して総合評価」

データベーステーブル定義のコメント統一:
- **行399**: `albums`テーブル - `trip_id`カラム説明「旅程ID」→「旅行プランID」
- **行415**: `memories`テーブル - `trip_id`カラム説明「旅程ID」→「旅行プランID」
- **行492**: `ratings`テーブル - `trip_id`カラム説明「旅程ID（旅行全体評価の場合）」→「旅行プランID（旅行全体評価の場合）」

---

### 2. ステータス情報の更新

#### 00-overview.md
主要機能のステータスを最新化:
- **行48**: 予算管理 - "未定義" → "✅ 確定"
- **行56**: 思い出の記録と共有 - "未定義" → "✅ 確定"
- **行63**: 多言語対応 - "未定義" → "✅ 確定"

今後の予定セクションを更新:
- **行184-189**: 
  - "旅程検索" → "旅行プラン検索"
  - "旅程の作成と管理" → "旅行プランの作成と管理（キャンバスベース含む）"
  - 予算管理、思い出共有、多言語対応を「ヒアリング予定」→「要件確定」に変更

---

### 3. 最終更新日の統一

全てのドキュメントの最終更新日を作業日に統一:
- **00-overview.md**: 2025-10-09 → 2025-10-13
- **05-i18n.md**: 2025-10-11 → 2025-10-13
- **03-budget-management.md**: 2025-10-09 → 2025-10-13
- **04-memory-sharing.md**: 2025-10-09 → 2025-10-13

---

### 4. 開発フェーズ説明の修正

#### 00-overview.md (行138-142)
**修正前**:
```markdown
### フェーズ1: MVP（最小実用製品） - 優先度: 高
- 旅行先の検索と表示
- 基本的な旅程作成
- シンプルな予算管理
- ローカルストレージでのデータ保存
```

**修正後**:
```markdown
### フェーズ1: MVP（最小実用製品） - 優先度: 高
- 旅行先の検索と表示
- キャンバスベース旅行プラン作成（複数プラン案の作成・比較）
- 基本的な旅行プラン作成
- シンプルな予算管理
- PostgreSQLデータベース保存
```

**変更理由**:
- キャンバスベース作成機能がコア機能として追加されたため
- 技術方針がローカルストレージからPostgreSQLに変更されたため

---

### 5. クロスリファレンスの更新

#### 03-budget-management.md (関連ドキュメントセクション)
**追加**:
- `[キャンバスベース旅行プラン作成](./02-1-canvas-planning.md)`

**修正**:
- "旅行先の検索と提案" → "旅行プラン検索"
- "旅程の作成と管理" → "旅行プランの作成と管理"

#### 04-memory-sharing.md (関連ドキュメントセクション)
**追加**:
- `[キャンバスベース旅行プラン作成](./02-1-canvas-planning.md)`

**修正**:
- "旅程の作成と管理" → "旅行プランの作成と管理"

---

### 6. 為替レート記述の削除確認

#### 07-external-services.md
- **結果**: 為替レート関連の記述なし（前セッションで既に削除済みと推測）
- **確認方法**: `grep`で`為替|exchange.*rate|currency|通貨`を検索し、該当なし

---

## データベーステーブル名の整合性

以下のテーブルで`trip_id`カラムのコメントを統一:

### 予算管理関連テーブル (03-budget-management.md)
1. **budgets** - 予算設定
2. **budget_categories** - 費目別予算
3. **expenses** - 実費記録
4. **settlements** - 精算情報
5. **budget_history** - 予算履歴

### 思い出共有関連テーブル (04-memory-sharing.md)
1. **albums** - アルバム
2. **memories** - 思い出コンテンツ
3. **ratings** - 評価・レビュー

全て「旅程ID（外部キー）」→「旅行プランID（外部キー）」に統一

---

## 確認済み事項

### 既に正しく設定されていた項目
1. **02-itinerary-management.md** - 関連ドキュメントセクションに既にキャンバス作成画面へのリンクあり
2. **02-1-canvas-planning.md** - 関連ドキュメントセクションが適切に設定済み
3. **01-search-and-proposal.md** - 前セッションで命名統一完了済み

---

## 影響範囲まとめ

### 修正したファイル (6ファイル)
1. `00-overview.md` - 7箇所修正
2. `03-budget-management.md` - 14箇所修正
3. `04-memory-sharing.md` - 16箇所修正
4. `05-i18n.md` - 4箇所修正

### 修正していないファイル (5ファイル)
- `01-search-and-proposal.md` - 前セッションで完了
- `02-itinerary-management.md` - 前セッションで完了
- `02-1-canvas-planning.md` - 新規作成時に正しく記述済み
- `06-non-functional.md` - 旅程/旅行プラン特有の記述なし
- `07-external-services.md` - 旅程/旅行プラン特有の記述なし

---

## 命名規則の最終確認

### データベース層 (snake_case)
- ✅ テーブル名: `trip_plans`, `trip_plan_members`, `trip_plan_days`, `trip_plan_activities`
- ✅ 外部キー: `trip_id` (説明: 旅行プランID)

### TypeScript/JavaScript層 (PascalCase/camelCase)
- ✅ 型名: `TripPlan`, `TripPlanMember`, `TripPlanDay`, `TripPlanActivity`
- ✅ 変数名: `tripPlan`, `tripPlanId`, `tripPlanMembers`

### API/ルート層 (kebab-case)
- ✅ エンドポイント: `/api/trip-plans`, `/api/trip-plans/:id`
- ✅ コンポーネントディレクトリ: `src/components/trip-plans/`

### UI/ドキュメント層 (日本語)
- ✅ 表示名: 「旅行プラン」「旅行プラン検索」「旅行プランの作成」
- ✅ ナビゲーション: `trip_plan: "旅行プラン"` / `trip_plan: "Trip Plan"`

### 翻訳ファイル
- ✅ ファイル名: `trip_plan.json` (旧: `itinerary.json`)
- ✅ キー名: `navigation.trip_plan`

---

## 完了基準の確認

### ✅ 命名規則の統一
- 全ドキュメントで「旅程」→「旅行プラン」に統一完了
- データベーステーブルコメントも統一完了
- i18n翻訳キーも統一完了

### ✅ ステータス情報の正確性
- 未定義だった3機能(予算管理、思い出共有、多言語対応)を「確定」に更新
- 今後の予定セクションを最新状態に更新

### ✅ 日付の整合性
- 4つのドキュメントの最終更新日を2025-10-13に統一

### ✅ 技術方針の正確性
- 開発フェーズ1の説明を現実に即した内容に修正
- ローカルストレージ→PostgreSQLへの変更を反映
- キャンバスベース作成機能を追加

### ✅ クロスリファレンスの完全性
- 全ドキュメントから02-1-canvas-planning.mdへの適切なリンク設定
- 関連ドキュメントセクションの用語統一

---

## 今後の注意事項

### 新規ドキュメント作成時
1. データベーステーブルの`trip_id`は「旅行プランID（外部キー）」と記述
2. 日本語では必ず「旅行プラン」を使用（「旅程」は使用しない）
3. 翻訳キーは`trip_plan`を使用
4. 関連ドキュメントセクションに02-1-canvas-planning.mdを含める

### コード実装時
1. データベーステーブル名: `trip_plans`系統を使用
2. TypeScript型名: `TripPlan`系統を使用
3. APIエンドポイント: `/api/trip-plans`系統を使用
4. UI表示: 「旅行プラン」を使用

### メモリファイル管理
- この作業記録は将来の整合性チェックの基準として活用可能
- 命名規則の詳細な対応表として参照可能

---

## 作業完了確認

- ✅ 6ファイルの修正完了
- ✅ 41箇所の修正実施
- ✅ 全ドキュメント間の整合性確保
- ✅ 命名規則の完全統一
- ✅ クロスリファレンスの完全性確保

**整合性修正作業は完了しました。**
